<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Members</title>
    <link rel="stylesheet" href="style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    \
    <style>
      .select-field {
        width: 100%;
        padding: 12px 14px;
        font-size: 14px;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        background-color: #fff;
        appearance: none;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      /* Custom arrow */
      .select-field {
        background-image: url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M6 9l6 6 6-6' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 14px center;
        background-size: 16px;
      }

      .select-field:focus {
        outline: none;
        border-color: #4f46e5;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15);
      }
    </style>
  </head>

  <body>
    <header class="header">
      <div class="logo">MemberFlow</div>
      <nav>
        <a href="index.html">Dashboard</a>
        <a href="members.html">Members</a>
        <a href="plans.html">Plans</a>
        <a href="payments.html">Payments</a>
        <a href="whatsapp-notifications.html">Whatsapp</a>
        <a href="#">Logout</a>
      </nav>
    </header>

    <main class="container">
      <div class="table-section">
        <div class="table-header">
          <h2>Members</h2>
          <a href="#add-member-modal" class="add-member-btn">+ Add Member</a>
        </div>

        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Member</th>
              <th>Email</th>
              <th>Plan</th>
              <th>Status</th>
              <th>Valid Till</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="membersTable"></tbody>
        </table>
      </div>
    </main>

    <footer class="footer">Â© 2025 MemberFlow. All rights reserved.</footer>

    <!-- ADD MEMBER MODAL -->
    <div id="add-member-modal" class="modal">
      <div class="modal-content">
        <h3>Add Member</h3>

        <form class="modal-form" onsubmit="addMember(event)">
          <label>Name</label>
          <input id="addName" required />

          <label>Email</label>
          <input id="addEmail" required />

          <div class="form-group">
            <label for="addPlan">Plan</label>
            <select id="addPlan" class="select-field" required>
              <option value="">Select a plan</option>
              <option>Basic</option>
              <option>Gold</option>
              <option>Platinum</option>
            </select>
          </div>

          <label>Valid Till</label>
          <input id="addValidTill" type="date" required />

          <div class="modal-actions">
            <a
              href="#"
              class="primary-btn"
              style="
                background-color: #e5e7eb;
                color: black;
                align-items: center;
                display: flex;
                justify-content: center;
                text-decoration: none;
              "
              >Cancel</a
            >
            <button class="primary-btn">Save</button>
          </div>
        </form>
      </div>
    </div>

    <!-- EDIT MEMBER MODAL -->
    <div id="edit-member-modal" class="modal">
      <div class="modal-content">
        <h3>Edit Member</h3>

        <form class="modal-form" onsubmit="updateMember(event)">
          <label>Name</label>
          <input id="editName" required />

          <label>Email</label>
          <input id="editEmail" required />
          <div class="form-group">
            <label>Plan</label>
            <select class="select-field" id="editPlan" required>
              <option>Basic</option>
              <option>Gold</option>
              <option>Platinum</option>
            </select>
          </div>
          <label>Valid Till</label>
          <input id="editValidTill" type="date" required />

          <div class="modal-actions">
            <a
              href="#"
              class="primary-btn"
              style="
                background-color: #e5e7eb;
                color: black;
                align-items: center;
                display: flex;
                justify-content: center;
                text-decoration: none;
              "
              >Cancel</a
            >

            <button class="primary-btn">Update</button>
          </div>
        </form>
      </div>
    </div>

    <!-- ACTIVATE MEMBER MODAL -->
    <div id="activate-member-modal" class="modal">
      <div class="modal-content">
        <h3>Activate Member</h3>

        <form class="modal-form" onsubmit="confirmActivate(event)">
          <label>Next Expiry Date</label>
          <input id="activateValidTill" type="date" required />

          <div class="modal-actions">
            <a
              href="#"
              class="primary-btn"
              style="
                background-color: #e5e7eb;
                color: black;
                align-items: center;
                display: flex;
                justify-content: center;
                text-decoration: none;
              "
              >Cancel</a
            >

            <button class="primary-btn">Activate</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      let members = JSON.parse(sessionStorage.getItem("members")) || [
        {
          id: 1,
          name: "Ravi Kumar",
          email: "ravi@email.com",
          plan: "Gold",
          status: "Active",
          validTill: "2025-12-12",
        },
        {
          id: 2,
          name: "Anita Sharma",
          email: "anita@email.com",
          plan: "Basic",
          status: "Expired",
          validTill: "2025-08-01",
        },
      ];

      let editMemberId = null;
      let activateMemberId = null;

      function save() {
        sessionStorage.setItem("members", JSON.stringify(members));
      }

      function renderMembers() {
        const tbody = document.getElementById("membersTable");
        tbody.innerHTML = "";

        members.forEach((m, i) => {
          const expired = m.status === "Expired";

          tbody.innerHTML += `
      <tr>
        <td>${i + 1}</td>
        <td>${m.name}</td>
        <td>${m.email}</td>
        <td>${m.plan}</td>
        <td>
          <span class="status ${expired ? "expired" : "active"}">
            ${m.status}
          </span>
        </td>
        <td>${formatDate(m.validTill)}</td>
        <td class="action-cell">
          <a href="#edit-member-modal"
             class="action-btn edit"
             onclick="openEdit(${m.id})">Edit</a>

          ${
            expired
              ? `
            <a href="#activate-member-modal"
               class="action-btn"
               onclick="openActivate(${m.id})">
              Activate
            </a>`
              : ""
          }

          <a href="#"
             class="action-btn danger"
             onclick="deleteMember(${m.id})">
             Delete
          </a>
        </td>
      </tr>
    `;
        });
      }

      function addMember(e) {
        e.preventDefault();

        members.push({
          id: Date.now(),
          name: addName.value,
          email: addEmail.value,
          plan: addPlan.value,
          status: "Active",
          validTill: addValidTill.value,
        });

        save();
        renderMembers();
        e.target.reset();
        location.hash = "";
      }

      function openEdit(id) {
        const m = members.find((x) => x.id === id);
        if (!m) return;

        editMemberId = id;
        editName.value = m.name;
        editEmail.value = m.email;
        editPlan.value = m.plan;
        editValidTill.value = m.validTill;
      }

      function updateMember(e) {
        e.preventDefault();

        const m = members.find((x) => x.id === editMemberId);
        if (!m) return;

        m.name = editName.value;
        m.email = editEmail.value;
        m.plan = editPlan.value;
        m.validTill = editValidTill.value;

        save();
        renderMembers();
        location.hash = "";
      }

      function openActivate(id) {
        activateMemberId = id;
        activateValidTill.value = "";
      }

      function confirmActivate(e) {
        e.preventDefault();

        const m = members.find((x) => x.id === activateMemberId);
        if (!m) return;

        m.status = "Active";
        m.validTill = activateValidTill.value;

        save();
        renderMembers();
        activateMemberId = null;
        location.hash = "";
      }

      function deleteMember(id) {
        if (!confirm("Delete this member permanently?")) return;

        members = members.filter((m) => m.id !== id);
        save();
        renderMembers();
      }

      function formatDate(dateStr) {
        return new Date(dateStr).toLocaleDateString("en-GB", {
          day: "2-digit",
          month: "short",
          year: "numeric",
        });
      }

      window.onload = renderMembers;
    </script>
  </body>
</html>
