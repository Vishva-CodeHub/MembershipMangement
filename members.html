<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Members</title>
    <link rel="stylesheet" href="style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      .select-field {
        width: 100%;
        padding: 12px 14px;
        font-size: 14px;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        background-color: #fff;
        appearance: none;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      /* Custom arrow */
      .select-field {
        background-image: url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M6 9l6 6 6-6' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 14px center;
        background-size: 16px;
      }

      .select-field:focus {
        outline: none;
        border-color: #4f46e5;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15);
      }
      .pagination {
        margin-top: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 12px;
      }

      .pagination button {
        padding: 8px 14px;
        font-size: 14px;
        border-radius: 6px;
        border: 1px solid #d1d5db;
        background-color: #fff;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .pagination button:hover {
        background-color: #f3f4f6;
      }

      .pagination button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .pagination span {
        font-size: 14px;
        font-weight: 500;
        color: #374151;
      }
    </style>
  </head>

  <body>
    <header class="header">
      <div class="logo">Membership Management</div>
      <nav>
        <a href="index.html">Dashboard</a>
        <a href="members.html">Members</a>
        <a href="plans.html">Plans</a>
        <a href="payments.html">Payments</a>
        <a href="whatsapp-notifications.html">Whatsapp</a>
        <a href="#">Logout</a>
      </nav>
    </header>

    <main class="container">
      <div class="table-section">
        <div class="table-header">
          <h2>Members</h2>
          <a href="#add-member-modal" class="add-member-btn">+ Add Member</a>
        </div>

        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Member</th>
              <th>Email</th>
              <th>Plan</th>
              <th>Status</th>
              <th>Valid Till</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="membersTable"></tbody>
        </table>
        <div class="pagination">
          <button onclick="prevPage()">Prev</button>
          <span id="pageInfo"></span>
          <button onclick="nextPage()">Next</button>
        </div>
      </div>
    </main>

    <footer class="footer">
      Â© 2025 Membership Management. All rights reserved.
    </footer>

    <!-- ADD MEMBER MODAL -->
    <div id="add-member-modal" class="modal">
      <div class="modal-content">
        <h3>Add Member</h3>

        <form class="modal-form" onsubmit="addMember(event)">
          <label>Name</label>
          <input id="addName" required />

          <label>Email</label>
          <input id="addEmail" required />

          <div class="form-group">
            <label for="addPlan">Plan</label>
            <select id="addPlan" class="select-field" required>
              <option value="">Select a plan</option>
              <option>Basic</option>
              <option>Gold</option>
              <option>Platinum</option>
            </select>
          </div>

          <label>Valid Till</label>
          <input id="addValidTill" type="date" required />

          <div class="modal-actions">
            <a
              href="#"
              class="primary-btn"
              style="
                background-color: #e5e7eb;
                color: black;
                align-items: center;
                display: flex;
                justify-content: center;
                text-decoration: none;
              "
              >Cancel</a
            >
            <button class="primary-btn">Save</button>
          </div>
        </form>
      </div>
    </div>

    <!-- EDIT MEMBER MODAL -->
    <div id="edit-member-modal" class="modal">
      <div class="modal-content">
        <h3>Edit Member</h3>

        <form class="modal-form" onsubmit="updateMember(event)">
          <label>Name</label>
          <input id="editName" required />

          <label>Email</label>
          <input id="editEmail" required />
          <div class="form-group">
            <label>Plan</label>
            <select class="select-field" id="editPlan" required>
              <option>Basic</option>
              <option>Gold</option>
              <option>Platinum</option>
            </select>
          </div>
          <label>Valid Till</label>
          <input id="editValidTill" type="date" required />

          <div class="modal-actions">
            <a
              href="#"
              class="primary-btn"
              style="
                background-color: #e5e7eb;
                color: black;
                align-items: center;
                display: flex;
                justify-content: center;
                text-decoration: none;
              "
              >Cancel</a
            >

            <button class="primary-btn">Update</button>
          </div>
        </form>
      </div>
    </div>

    <!-- ACTIVATE MEMBER MODAL -->
    <div id="activate-member-modal" class="modal">
      <div class="modal-content">
        <h3>Activate Member</h3>

        <form class="modal-form" onsubmit="confirmActivate(event)">
          <label>Next Expiry Date</label>
          <input id="activateValidTill" type="date" required />

          <div class="modal-actions">
            <a
              href="#"
              class="primary-btn"
              style="
                background-color: #e5e7eb;
                color: black;
                align-items: center;
                display: flex;
                justify-content: center;
                text-decoration: none;
              "
              >Cancel</a
            >

            <button class="primary-btn">Activate</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      const PAGE_SIZE = 8;
      let currentPage = 1;

      let members = JSON.parse(sessionStorage.getItem("members")) || [
        {
          id: 1,
          name: "Ravi Kumar",
          email: "ravi@email.com",
          plan: "Gold",
          status: "Active",
          validTill: "2025-12-12",
        },
        {
          id: 2,
          name: "Anita Sharma",
          email: "anita@email.com",
          plan: "Basic",
          status: "Expired",
          validTill: "2025-08-01",
        },
        {
          id: 3,
          name: "Suresh Patel",
          email: "suresh@email.com",
          plan: "Platinum",
          status: "Active",
          validTill: "2026-01-10",
        },
        {
          id: 4,
          name: "Kiran Rao",
          email: "kiran@email.com",
          plan: "Gold",
          status: "Expired",
          validTill: "2025-06-30",
        },
        {
          id: 5,
          name: "Manoj Das",
          email: "manoj@email.com",
          plan: "Basic",
          status: "Active",
          validTill: "2025-11-20",
        },
        {
          id: 6,
          name: "Priya Singh",
          email: "priya@email.com",
          plan: "Platinum",
          status: "Active",
          validTill: "2026-03-05",
        },
        {
          id: 7,
          name: "Amit Verma",
          email: "amit@email.com",
          plan: "Gold",
          status: "Expired",
          validTill: "2025-05-18",
        },
        {
          id: 8,
          name: "Neha Jain",
          email: "neha@email.com",
          plan: "Basic",
          status: "Active",
          validTill: "2025-10-01",
        },
        {
          id: 9,
          name: "Rohit Mehta",
          email: "rohit@email.com",
          plan: "Gold",
          status: "Active",
          validTill: "2026-02-15",
        },
        {
          id: 10,
          name: "Pooja Nair",
          email: "pooja@email.com",
          plan: "Platinum",
          status: "Expired",
          validTill: "2025-04-12",
        },
        {
          id: 11,
          name: "Vikas Iyer",
          email: "vikas@email.com",
          plan: "Basic",
          status: "Active",
          validTill: "2025-12-30",
        },
        {
          id: 12,
          name: "Sneha Roy",
          email: "sneha@email.com",
          plan: "Gold",
          status: "Active",
          validTill: "2026-01-22",
        },
        {
          id: 13,
          name: "Deepak Yadav",
          email: "deepak@email.com",
          plan: "Basic",
          status: "Expired",
          validTill: "2025-03-10",
        },
        {
          id: 14,
          name: "Lakshmi Menon",
          email: "lakshmi@email.com",
          plan: "Platinum",
          status: "Active",
          validTill: "2026-04-01",
        },
        {
          id: 15,
          name: "Arjun Kapoor",
          email: "arjun@email.com",
          plan: "Gold",
          status: "Active",
          validTill: "2025-09-14",
        },
        {
          id: 16,
          name: "Meena Gupta",
          email: "meena@email.com",
          plan: "Basic",
          status: "Expired",
          validTill: "2025-02-28",
        },
        {
          id: 17,
          name: "Rahul Bose",
          email: "rahul@email.com",
          plan: "Gold",
          status: "Active",
          validTill: "2026-06-10",
        },
      ];

      let editMemberId = null;
      let activateMemberId = null;

      function save() {
        sessionStorage.setItem("members", JSON.stringify(members));
      }

      function renderMembers() {
        const tbody = document.getElementById("membersTable");
        tbody.innerHTML = "";

        const start = (currentPage - 1) * PAGE_SIZE;
        const paginatedMembers = members.slice(start, start + PAGE_SIZE);

        paginatedMembers.forEach((m, i) => {
          const expired = m.status === "Expired";

          tbody.innerHTML += `
        <tr>
          <td>${start + i + 1}</td>
          <td>${m.name}</td>
          <td>${m.email}</td>
          <td>${m.plan}</td>
          <td>
            <span class="status ${expired ? "expired" : "active"}">
              ${m.status}
            </span>
          </td>
          <td>${formatDate(m.validTill)}</td>
          <td class="action-cell">
            <a href="#edit-member-modal" class="action-btn edit" onclick="openEdit(${
              m.id
            })">Edit</a>
            ${
              expired
                ? `<a href="#activate-member-modal" class="action-btn" onclick="openActivate(${m.id})">Activate</a>`
                : ""
            }
            <a href="#delete-member-modal"
   class="action-btn danger"
   onclick="openDeleteModal(${m.id})">
   Delete
</a>

          </td>
        </tr>
      `;
        });

        updatePaginationInfo();
      }
      function updatePaginationInfo() {
        const totalPages = Math.ceil(members.length / PAGE_SIZE);
        document.getElementById(
          "pageInfo"
        ).innerText = `Page ${currentPage} of ${totalPages}`;

        document.querySelector(".pagination button:first-child").disabled =
          currentPage === 1;
        document.querySelector(".pagination button:last-child").disabled =
          currentPage === totalPages;
      }

      function updatePaginationInfo() {
        const totalPages = Math.ceil(members.length / PAGE_SIZE);
        document.getElementById(
          "pageInfo"
        ).innerText = `Page ${currentPage} of ${totalPages}`;
      }

      function nextPage() {
        const totalPages = Math.ceil(members.length / PAGE_SIZE);
        if (currentPage < totalPages) {
          currentPage++;
          renderMembers();
        }
      }

      function prevPage() {
        if (currentPage > 1) {
          currentPage--;
          renderMembers();
        }
      }

      function addMember(e) {
        e.preventDefault();

        members.push({
          id: Date.now(),
          name: addName.value,
          email: addEmail.value,
          plan: addPlan.value,
          status: "Active",
          validTill: addValidTill.value,
        });

        save();
        currentPage = Math.ceil(members.length / PAGE_SIZE);
        renderMembers();
        e.target.reset();
        location.hash = "";
      }

      function openEdit(id) {
        const m = members.find((x) => x.id === id);
        if (!m) return;

        editMemberId = id;
        editName.value = m.name;
        editEmail.value = m.email;
        editPlan.value = m.plan;
        editValidTill.value = m.validTill;
      }

      function updateMember(e) {
        e.preventDefault();

        const m = members.find((x) => x.id === editMemberId);
        if (!m) return;

        m.name = editName.value;
        m.email = editEmail.value;
        m.plan = editPlan.value;
        m.validTill = editValidTill.value;

        save();
        renderMembers();
        location.hash = "";
      }

      function openActivate(id) {
        activateMemberId = id;
        activateValidTill.value = "";
      }

      function confirmActivate(e) {
        e.preventDefault();

        const m = members.find((x) => x.id === activateMemberId);
        if (!m) return;

        m.status = "Active";
        m.validTill = activateValidTill.value;

        save();
        renderMembers();
        location.hash = "";
      }

      let deleteMemberId = null;

      function openDeleteModal(id) {
        deleteMemberId = id;
      }

      function closeDeleteModal() {
        deleteMemberId = null;
        location.hash = "";
      }

      function confirmDelete() {
        if (!deleteMemberId) return;

        members = members.filter((m) => m.id !== deleteMemberId);
        save();

        const totalPages = Math.ceil(members.length / PAGE_SIZE);
        if (currentPage > totalPages) currentPage = totalPages || 1;

        renderMembers();
        closeDeleteModal();
      }

      function formatDate(dateStr) {
        return new Date(dateStr).toLocaleDateString("en-GB", {
          day: "2-digit",
          month: "short",
          year: "numeric",
        });
      }

      window.onload = renderMembers;
    </script>
    <!-- DELETE MEMBER MODAL -->
    <div id="delete-member-modal" class="modal">
      <div class="modal-content">
        <h3>Delete Member</h3>
        <p style="margin: 10px 0 20px; color: #6b7280">
          Are you sure you want to delete this member permanently?
        </p>

        <div class="modal-actions">
          <a
            href="#"
            class="primary-btn"
            style="
              background-color: #e5e7eb;
              color: black;
              display: flex;
              align-items: center;
              justify-content: center;
              text-decoration: none;
            "
            onclick="closeDeleteModal()"
          >
            Cancel
          </a>

          <button class="primary-btn danger" onclick="confirmDelete()">
            Delete
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
